<!DOCTYPE html>
<html lang="en">

  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0"/>

    <title>Send-Rest.li-Request-Query-In-Request-Body</title>
    <meta name="description" content="A REST framework for building scalable service architectures using dynamic discovery and simple asynchronous APIs" />

    <link rel="icon"
      type="image/png"
      href="/images/icon_pegasus.png">
  
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" type="text/css" media="screen,projection" href="/assets/materialize.css" />
    <link rel="stylesheet" type="text/css" media="screen,projection" href="/assets/main.css">
    <link rel="canonical" href="http://localhost:4000/Send-Rest_li-Request-Query-In-Request-Body" />
    <link rel="alternate" type="application/rss+xml" title="rest.li" href="/feed.xml" />
  
    
</head>


  <body>

    <nav class="dark-grey" role="navigation">
    <div class="nav-wrapper container"><a id="logo-container" class="brand-logo" href="/">Rest.li</a>


          <ul class="right hide-on-med-and-down">
               
      
        <li>
          <a href="/rest.li/get_started/quick_start" >
            Getting Started
          </a>
        </li>
        
        <li>
          <a href="/rest.li/user_guide/server_architecture" >
            User guide
          </a>
        </li>
        
        <li>
          <a href="/rest.li/reference/architecture" >
            API reference
          </a>
        </li>
        
        <li>
          <a href="/rest.li/contribute/howto" >
            Contribute
          </a>
        </li>
        
          </ul>


      <a href="#" data-activates="nav-mobile" class="button-collapse"><i class="material-icons">menu</i></a>
    </div>
</nav>


        <div class="container">
        <div class="row">
                <div class="col s12 m4 l3"> 
               
                    
                   
                    
                     <ul class="nav_items">
                        <li><span class="nav_sub-title">User Guide</span></li>
                        <ul>
                       
                         <li><a href="/rest.li/user_guide/server_architecture">Rest.li Architecture</a></li>
                       
                         <li><a href="/rest.li/user_guide/restli_server">Rest.li Server</a></li>
                       
                         <li><a href="/rest.li/user_guide/restli_client">Rest.li Client Framework</a></li>
                       
                        </ul>
                     </ul>
                        
                   
                    
                     <ul class="nav_items">
                        <li><span class="nav_sub-title">Spec</span></li>
                        <ul>
                       
                         <li><a href="/rest.li/spec/protocol">Rest.li Protocol</a></li>
                       
                         <li><a href="/rest.li/spec/restspec_format">Restspec json format</a></li>
                       
                        </ul>
                     </ul>
                        
                   
                    
                     <ul class="nav_items">
                        <li><span class="nav_sub-title">Modeling Resources</span></li>
                        <ul>
                       
                         <li><a href="/rest.li/modeling/modeling">Modeling Resources</a></li>
                       
                         <li><a href="/rest.li/modeling/compatibiltiy_check">Snapshots and Resource Compatibility Checking</a></li>
                       
                        </ul>
                     </ul>
                        
                   
                    
                     <ul class="nav_items">
                        <li><span class="nav_sub-title">wiki</span></li>
                        <ul>
                       
                         <li><a href="/rest.li/Asynchronous-Servers-and-Clients-in-Rest_li">Asynchronous-Servers-and-Clients-in-Rest.li</a></li>
                       
                         <li><a href="/rest.li/Attachment-Streaming">Attachment-Streaming</a></li>
                       
                         <li><a href="/rest.li/Building-Rest_li-from-Source">Building-Rest.li-from-Source</a></li>
                       
                         <li><a href="/rest.li/Components">Components</a></li>
                       
                         <li><a href="/rest.li/Compression">Compression</a></li>
                       
                         <li><a href="/rest.li/D2-Zookeeper-Properties">D2-Zookeeper-Properties</a></li>
                       
                         <li><a href="/rest.li/DATA-Data-Schema-and-Templates">DATA-Data-Schema-and-Templates</a></li>
                       
                         <li><a href="/rest.li/Data-FAQ">Data-FAQ</a></li>
                       
                         <li><a href="/rest.li/Dynamic_Discovery">Dynamic_Discovery</a></li>
                       
                         <li><a href="/rest.li/Guice-Dependency-Injection">Guice-Dependency-Injection</a></li>
                       
                         <li><a href="/rest.li/How_To:Rest_li_Avro_conversions">How_To:Rest.li_Avro_conversions</a></li>
                       
                         <li><a href="/rest.li/How-to-use-projections-in-Java">How-to-use-projections-in-Java</a></li>
                       
                         <li><a href="/rest.li/Modeling-Resources-with-Rest_li">Modeling-Resources-with-Rest.li</a></li>
                       
                         <li><a href="/rest.li/Projections">Projections</a></li>
                       
                         <li><a href="/rest.li/Request-Response-API-(R2)">Request-Response-API-(R2)</a></li>
                       
                         <li><a href="/rest.li/Request-Response-Framework">Request-Response-Framework</a></li>
                       
                         <li><a href="/rest.li/Rest_li-2_0-response-API">Rest.li-2.0-response-API</a></li>
                       
                         <li><a href="/rest.li/Rest_li-2_x-upgrade-instructions">Rest.li-2.x-upgrade-instructions</a></li>
                       
                         <li><a href="/rest.li/Rest_li-Filters">Rest.li-Filters</a></li>
                       
                         <li><a href="/rest.li/Rest_li-Protocol">Rest.li-Protocol</a></li>
                       
                         <li><a href="/rest.li/Rest_li-with-Netty">Rest.li-with-Netty</a></li>
                       
                         <li><a href="/rest.li/Rest_li-with-Servlet-Containers">Rest.li-with-Servlet-Containers</a></li>
                       
                         <li><a href="/rest.li/Scala-Integration">Scala-Integration</a></li>
                       
                         <li><a href="/rest.li/Send-Rest_li-Request-Query-In-Request-Body">Send-Rest.li-Request-Query-In-Request-Body</a></li>
                       
                         <li><a href="/rest.li/Spring-Dependency-Injection">Spring-Dependency-Injection</a></li>
                       
                         <li><a href="/rest.li/Validation-in-Rest_li">Validation-in-Rest.li</a></li>
                       
                         <li><a href="/rest.li/Writing-unit-tests-for-Rest_li-clients-and-servers">Writing-unit-tests-for-Rest.li-clients-and-servers</a></li>
                       
                        </ul>
                     </ul>
                        
                    </div>
                     <div class="markdown-body col s12 m3 l9">
                            <h2 id="contents">Contents</h2>

<ul>
  <li><a href="#introduction">Introduction</a></li>
  <li><a href="#clientquerytunnelfilter-and-serverquerytunnelfilter">ClientQueryTunnelFilter and
ServerQueryTunnelFilter</a></li>
  <li><a href="#request-without-body">Request Without Body</a></li>
  <li><a href="#request-with-body">Request With Body</a></li>
</ul>

<h2 id="introduction">Introduction</h2>

<p><a href="https://github.com/linkedin/rest.li/wiki/Rest.li-Protocol">Rest.li
protocol</a>
specifies what HTTP method will be used for each type of Rest.li
request. However, sometimes due to security constraint (i.e. not wanting
to send some sensitive information in URI) or jetty buffer limitation
(i.e. there may pose a threshold on the longest query that can go
through), we may want to customize the HTTP method used to send a
particular Rest.li request to a Rest.li server.</p>

<h2 id="clientquerytunnelfilter-and-serverquerytunnelfilter">ClientQueryTunnelFilter and ServerQueryTunnelFilter</h2>

<p>Rest.li has provided
<a href="https://github.com/linkedin/rest.li/blob/master/r2-core/src/main/java/com/linkedin/r2/filter/transport/ClientQueryTunnelFilter.java">ClientQueryTunnelFilter</a>
(R2 client filter) and
<a href="https://github.com/linkedin/rest.li/blob/master/r2-core/src/main/java/com/linkedin/r2/filter/transport/ServerQueryTunnelFilter.java">ServerQueryTunnelFilter</a>
(R2 server filter) to support such HTTP method customization. These two
filters behaves as follows:</p>

<ul>
  <li>On sending a rest request from client, ClientQueryTunnelFilter will
invoke
<a href="https://github.com/linkedin/rest.li/blob/master/r2-core/src/main/java/com/linkedin/r2/message/QueryTunnelUtil.java">QueryTunnelUtil</a>
encoding function to encode a standard non-POST rest.li request by
moving the query param line into the body, and reformulating the
request as a POST. The original method is specified by the
<code class="highlighter-rouge">X-HTTP-Method-Override</code> header. This header is important to
indicate that on the server side we should invoke QueryTunnelUtil
decoding function to get back original request so that this
conversion looks completely transparent to users. User can indicate
whether they want to perform such encoding in two ways:</li>
</ul>

<!-- end list -->

<ol>
  <li>Either by specifying a queryPostThreshold in initializing
ClientQueryTunnelFilter. That means if the rest request raw query
length is greater than this specified queryPostTreshold,
ClientQueryTunnelFilter will automatically convert this request to
POST.</li>
  <li>Or by forcing request conversion to specify in request context
    <code class="highlighter-rouge">
       requestContext.putLocalAttr(R2Constants.FORCE_QUERY_TUNNEL, true);
   </code></li>
</ol>

<!-- end list -->

<ul>
  <li>On receiving a rest request at server, ServerQueryTunnelFilter will
invoke QueryTunnelUtil.decode to convert request back to its
original form based on a special header set by
ClientQueryTunnelFilter, that is, <code class="highlighter-rouge">X-HTTP-Method-Override</code>.</li>
</ul>

<h2 id="request-without-body">Request Without Body</h2>

<p>For a rest.li request without body, for example, a BATCH_GET request
like this <code class="highlighter-rouge">http://localhost?ids=List(1,2,3)</code>, the transformed POST
request is x-www-form-urlencoded with query params stored in the body,
as follows:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>```
   curl -X POST -H "X-HTTP-Method-Override: GET" -H "Content-Type: application/x-www-form-urlencoded" 
               --data $'ids=1,2,3' http://localhost 
```
</code></pre></div></div>

<p>Basically,</p>

<ul>
  <li>change GET to POST (<code class="highlighter-rouge">-X POST</code>)</li>
  <li>add X-HTTP-Method-Override header for original HTTP method (<code class="highlighter-rouge">-H
"X-HTTP-Method-Override: GET"</code>)</li>
  <li>add Content-Type header (<code class="highlighter-rouge">-H "Content-Type:
application/x-www-form-urlencoded"</code>)</li>
  <li>move all the query string to body (@—data $’ids=List(1,2,3)’)<br />
Note that if QueryTunnelUtil need to do actual encoding or decoding,
the request would be fully buffered first,<br />
even if it’s streaming.<br />
We believe QueryTunnelUtil is almost exclusively for GET requests,
practically no use case would require<br />
excessively long query for POST &amp; PUT, and we’d be surprised if
anyone is using QueryTunnelUtil for PUT &amp; GET.<br />
Hence, fully buffering request that has to be encoded/decoded is
practically not a problem and gives up the best<br />
return for the investment of our efforts.</li>
</ul>

<h2 id="request-with-body">Request With Body</h2>

<p>For a rest.li request with body, for example, a BATCH_UPDATE request
like this <code class="highlighter-rouge">http://localhost?ids=List(1,2,3)</code>, the transformed POST
request will be of Content-Type of multipart/mixed with 2 sections:</p>

<ol>
  <li>The first section should be of type x-www-form-urlencoded and
contain the query params</li>
  <li>The second should contain what would have been the original body,
along with it’s associated content-type.</li>
</ol>

<p>It will look as follows:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>```
    curl -X POST -H "X-HTTP-Method-Override: PUT" -H "Content-Type: multipart/mixed; boundary=xyz" 
       --data $'--xyz\r\nContent-Type: application/x-www-form-urlencoded\r\n\r\nids=List(1,2,3)\r\n--xyz\r\n 
              Content-Type: application/json\r\n\r\n{"foo":"bar"}\r\n--xyz--' 
              http://localhost 
```
</code></pre></div></div>

<p>Here,</p>

<ul>
  <li>change GET to POST (<code class="highlighter-rouge">-X POST</code>)</li>
  <li>add X-HTTP-Method-Override header for original HTTP method (<code class="highlighter-rouge">-H
"X-HTTP-Method-Override: GET"</code>)</li>
  <li>add Content-Type header (<code class="highlighter-rouge">-H "Content-Type: multipart/mixed;
boundary=xyz"</code>). Note that here we need to specify a boundary
delimiter (here we use <code class="highlighter-rouge">xyz</code> for illustration) for multipart body,
this delimiter needs to be unique and not appearing in your request
content body or url.</li>
  <li>move all the query string and original request body to body as two
sections explained above.</li>
</ul>

                     </div>
                   </div>
</div>



      <footer class="page-footer">
    <div class="container">
      <div class="row">
        <div class="col s6">
          <h5>Rest.li</h5>
          <p class="text-lighten-4">Rest.li is an open source REST framework for building robust, scalable RESTful architectures using type-safe bindings and asynchronous, non-blocking IO. Rest.li fills a niche for applying RESTful principles at scale with an end-to-end developer workflow for building REST APIs, which promotes clean REST practices, uniform interface design and consistent data modeling.</p>
        </div>
        <div class="col s5 offset-s1">
          <h5 class="black-text">Community</h5>
          <ul>
              <li>Github <a class="" href="https://github.com/linkedin/rest.li">Rest.li</a></li>
              <li>Linkedin <a class="" href="http://www.linkedin.com/groups/Restli-4855943">Rest.li Group</a></li>
            <li>Follow us on twitter: <a class="" href="https://twitter.com/rest_li"> @rest_li</a></li>
            <li>Issue Tracking: <a class="" href="https://github.com/linkedin/rest.li/issues">github issue tracking</a></li>
          </ul>
        </div>
      </div>
    </div>
    <div class="footer-copyright">
        <div class="container">
            <div>
                <span style="text-align: right; float: left">
                Copyright © 2018. Powered by <a target="_blank" href="http://jekyllrb.com/" class="black-text text-lighten-3">Jekyll</a>
                </span> 
            </div>
        </div>  
    </div>
</footer>
      
    <!--  Scripts-->                                                                               
<script src="/js/jquery.min.js"></script>
<script src="/js/materialize.min.js"></script>
<script src="/js/init.js"></script>

  </body>

</html>
