<!DOCTYPE html>
<html lang="en">

  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0"/>

    <title>Validation-in-Rest.li</title>
    <meta name="description" content="A REST framework for building scalable service architectures using dynamic discovery and simple asynchronous APIs" />

    <link rel="icon"
      type="image/png"
      href="/images/icon_pegasus.png">
  
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" type="text/css" media="screen,projection" href="/assets/materialize.css" />
    <link rel="stylesheet" type="text/css" media="screen,projection" href="/assets/main.css">
    <link rel="canonical" href="http://localhost:4000/rest.li/Validation-in-Rest_li" />
    <link rel="alternate" type="application/rss+xml" title="rest.li" href="/feed.xml" />
  
    
</head>


  <body>

    <nav class="dark-grey" role="navigation">
    <div class="nav-wrapper container"><a id="logo-container" class="brand-logo" href="/">Rest.li</a>


          <ul class="right hide-on-med-and-down">
               
      
        <li>
          <a href="/rest.li/get_started/quick_start" >
            Getting Started
          </a>
        </li>
        
        <li>
          <a href="/rest.li/user_guide/server_architecture" >
            User guide
          </a>
        </li>
        
        <li>
          <a href="/rest.li/reference/architecture" >
            API reference
          </a>
        </li>
        
        <li>
          <a href="/rest.li/contribute/howto" >
            Contribute
          </a>
        </li>
        
          </ul>


      <a href="#" data-activates="nav-mobile" class="button-collapse"><i class="material-icons">menu</i></a>
    </div>
</nav>


        <div class="container">
        <div class="row">
                <div class="col s12 m4 l3"> 
               
                    
                   
                    
                     <ul class="nav_items">
                        <li><span class="nav_sub-title">User Guide</span></li>
                        <ul>
                       
                         <li><a href="/rest.li/user_guide/server_architecture">Rest.li Architecture</a></li>
                       
                         <li><a href="/rest.li/user_guide/restli_server">Rest.li Server</a></li>
                       
                         <li><a href="/rest.li/user_guide/restli_client">Rest.li Client Framework</a></li>
                       
                        </ul>
                     </ul>
                        
                   
                    
                     <ul class="nav_items">
                        <li><span class="nav_sub-title">Spec</span></li>
                        <ul>
                       
                         <li><a href="/rest.li/spec/protocol">Rest.li Protocol</a></li>
                       
                         <li><a href="/rest.li/spec/restspec_format">Restspec json format</a></li>
                       
                        </ul>
                     </ul>
                        
                   
                    
                     <ul class="nav_items">
                        <li><span class="nav_sub-title">Modeling Resources</span></li>
                        <ul>
                       
                         <li><a href="/rest.li/modeling/modeling">Modeling Resources</a></li>
                       
                         <li><a href="/rest.li/modeling/compatibiltiy_check">Snapshots and Resource Compatibility Checking</a></li>
                       
                        </ul>
                     </ul>
                        
                   
                    
                     <ul class="nav_items">
                        <li><span class="nav_sub-title">wiki</span></li>
                        <ul>
                       
                         <li><a href="/rest.li/Asynchronous-Servers-and-Clients-in-Rest_li">Asynchronous-Servers-and-Clients-in-Rest.li</a></li>
                       
                         <li><a href="/rest.li/Attachment-Streaming">Attachment-Streaming</a></li>
                       
                         <li><a href="/rest.li/Building-Rest_li-from-Source">Building-Rest.li-from-Source</a></li>
                       
                         <li><a href="/rest.li/Components">Components</a></li>
                       
                         <li><a href="/rest.li/Compression">Compression</a></li>
                       
                         <li><a href="/rest.li/D2-Zookeeper-Properties">D2-Zookeeper-Properties</a></li>
                       
                         <li><a href="/rest.li/DATA-Data-Schema-and-Templates">DATA-Data-Schema-and-Templates</a></li>
                       
                         <li><a href="/rest.li/Data-FAQ">Data-FAQ</a></li>
                       
                         <li><a href="/rest.li/Dynamic_Discovery">Dynamic_Discovery</a></li>
                       
                         <li><a href="/rest.li/Guice-Dependency-Injection">Guice-Dependency-Injection</a></li>
                       
                         <li><a href="/rest.li/How_To:Rest_li_Avro_conversions">How_To:Rest.li_Avro_conversions</a></li>
                       
                         <li><a href="/rest.li/How-to-use-projections-in-Java">How-to-use-projections-in-Java</a></li>
                       
                         <li><a href="/rest.li/Modeling-Resources-with-Rest_li">Modeling-Resources-with-Rest.li</a></li>
                       
                         <li><a href="/rest.li/Projections">Projections</a></li>
                       
                         <li><a href="/rest.li/Request-Response-API-(R2)">Request-Response-API-(R2)</a></li>
                       
                         <li><a href="/rest.li/Request-Response-Framework">Request-Response-Framework</a></li>
                       
                         <li><a href="/rest.li/Rest_li-2_0-response-API">Rest.li-2.0-response-API</a></li>
                       
                         <li><a href="/rest.li/Rest_li-2_x-upgrade-instructions">Rest.li-2.x-upgrade-instructions</a></li>
                       
                         <li><a href="/rest.li/Rest_li-Filters">Rest.li-Filters</a></li>
                       
                         <li><a href="/rest.li/Rest_li-Protocol">Rest.li-Protocol</a></li>
                       
                         <li><a href="/rest.li/Rest_li-with-Netty">Rest.li-with-Netty</a></li>
                       
                         <li><a href="/rest.li/Rest_li-with-Servlet-Containers">Rest.li-with-Servlet-Containers</a></li>
                       
                         <li><a href="/rest.li/Scala-Integration">Scala-Integration</a></li>
                       
                         <li><a href="/rest.li/Send-Rest_li-Request-Query-In-Request-Body">Send-Rest.li-Request-Query-In-Request-Body</a></li>
                       
                         <li><a href="/rest.li/Spring-Dependency-Injection">Spring-Dependency-Injection</a></li>
                       
                         <li><a href="/rest.li/Validation-in-Rest_li">Validation-in-Rest.li</a></li>
                       
                         <li><a href="/rest.li/Writing-unit-tests-for-Rest_li-clients-and-servers">Writing-unit-tests-for-Rest.li-clients-and-servers</a></li>
                       
                        </ul>
                     </ul>
                        
                    </div>
                     <div class="markdown-body col s12 m3 l9">
                            <p>There are many situations in which incoming or outgoing data should be
validated. For example, when creating a record which stores user
information, you may want to check that the username field doesn’t
contain special characters, or you may want to ensure that all required
(non-optional) fields are present before processing the incoming record.
When a required field is not present (and doesn’t have a default value
either), calling getXXX() will throw a
<code class="highlighter-rouge">RequiredFieldNotPresentException</code>. So validating the entity beforehand
can simplify the error handling code because you wouldn’t need to call
hasXXX() for every single field before calling getXXX(). Also, you may
want to check that clients are not trying to modify certain fields, like
server-generated ids or timestamps. Rest.li validation provides a
mechanism to perform such validation.</p>

<p>To use Rest.li’s validation feature, you need to specify validation
rules and choose how to enable validation.</p>

<h2 id="specifying-validation-rules">Specifying Validation Rules</h2>

<p>Rest.li validates using three types of rules:</p>

<ol>
  <li>Schema validation rules (checking the type of field values and the
presence of required fields)</li>
  <li>Custom validation rules (checking whether a number is in some range,
matching a string to a regular expression, etc)</li>
  <li>Rest.li validation annotations (
<span style="text-align:left;">code&gt;<code class="highlighter-rouge">ReadOnly</code><code class="highlighter-rouge">% and
%</code><code class="highlighter-rouge">CreateOnly</code>`</span>)</li>
</ol>

<p>The first two rules are specified in the data schema (.pdsc file), and
the third one is specified in the resource implementation. This is
because the first two rules only deal with information in the data
itself, but the third rule also needs additional Rest.li context such as
the method type. For example, a read only field shouldn’t be included in
a create request, but should be included in a get response.</p>

<p>For partial update requests (patches), the goal is to ensure that if the
patch is applied to a valid entity, the modified entity will also be
valid. For example, a patch that deletes a required field is invalid
because the modified entity will be missing that field. If there is a
custom validation rule on the username field that it must be at least 3
characters, a patch setting the username to “AA” is invalid.</p>

<p>You can read more about required and optional fields in <a href="https://github.com/linkedin/rest.li/wiki/DATA-Data-Schema-and-Templates#optional-fields">Data Schema and
Templates - Optional
Fields</a>.</p>

<h2 id="custom-validation-rules">Custom Validation Rules</h2>

<p>Rest.li includes <a href="https://github.com/linkedin/rest.li/tree/master/data/src/main/java/com/linkedin/data/schema/validator">some customizable
validators</a>,
such as “strlen” and “regex”, that can be added to schemas. Developers
can write additional validators for any specific need.</p>

<p>For example, to use “strlen” to validate a string between 1 and 20 chars
long, we add it to the “validate” map of the field in the schema, for
example:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{  
“name”: “Fortune”,  
“namespace”: “com.example”,  
“type”: “record”,  
“fields”: \[  
{  
“name”: “message”,  
“type”: “string”,  
“validate”: {  
“strlen”: {  
“min”: 1,  
“max”: 20  
}  
}  
}  
\]  
}  
</code></pre></div></div>

<p>Validator names are case sensitive and must have a matching validator
Java class in the current classpath. Rest.li finds the validator class
by uppercasing the first letter of the validator name and appending the
“Validator” suffix. For example, “strlen” maps to
<a href="https://github.com/linkedin/rest.li/blob/master/data/src/main/java/com/linkedin/data/schema/validator/StrlenValidator.java">StrlenValidator</a>.
Developers writing additional validators only need to write a class
extending <code class="highlighter-rouge">AbstractValidator</code> and include it in the classpath to use it.</p>

<p>Additional details are described in the javadoc for
<a href="https://github.com/linkedin/rest.li/blob/master/data/src/main/java/com/linkedin/data/schema/validator/DataSchemaAnnotationValidator.java">DataSchemaAnnotationValidator</a>.</p>

<h2 id="restli-validation-annotations">Rest.li Validation Annotations</h2>

<p>Fields in a pegasus data schema can be either required or optional.
However, there are certain cases where this distinction is not
expressive enough. For example, a client shouldn’t send a
server-generated id in a create request (i.e. id is optional), but the
server must send the id when responding to a get request (i.e. id is
required). To cover cases like this, we introduce two new Rest.li
validation annotations:
<span style="text-align:left;">code&gt;<code class="highlighter-rouge">ReadOnly</code><code class="highlighter-rouge">% and
%</code><code class="highlighter-rouge">CreateOnly</code>`</span>.</p>

<p>A @<code class="highlighter-rouge">ReadOnly</code> field cannot be set or changed by the client, ex.
server-generated ID field. A @<code class="highlighter-rouge">CreateOnly</code> field can be set the client
when creating the entity, but cannot be changed by the client
afterwards. This annotation implies that the field is immutable, ex. a
purchase price. The client will send the price to the CREATE method
while creating a purchase entry.</p>

<p>As a best practice, Rest.li validation annotation should not conflict
with schema validation rules and custom validation rules specified in
the schema. For example, @<code class="highlighter-rouge">ReadOnly</code> should only be used to enforce that
an optional field is not present. It should not be specified for a
required field, making missing required field value valid.</p>

<p>The <a href="https://github.com/linkedin/rest.li/blob/master/restli-common/src/main/java/com/linkedin/restli/common/validation/RestLiDataValidator.java">Rest.li data
validator</a>
will enforce the following rules for fields in request data based on the
annotation:</p>

<table>
  <thead>
    <tr>
      <th> </th>
      <th>Create</th>
      <th>Partial Update</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="highlighter-rouge">@ReadOnly</code></td>
      <td>Must not be present (See notes below)</td>
      <td>Must not be present</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">@CreateOnly</code></td>
      <td>N/A</td>
      <td>Must not be present</td>
    </tr>
  </tbody>
</table>

<p>Batch create, batch update, and batch partial update are treated the
same as create, update, and partial update respectively. Note that
validation is not turned on by default, and servers have to manually
call the validator or use the validation filter.</p>

<h3 id="notes-on-readonly-validation-rules-for-create-request">Notes on @ReadOnly Validation Rules for Create Request</h3>

<p>If @<code class="highlighter-rouge">ReadOnly</code> is specified to a field that is required in schema, the
field is treated as optional and the validation rule enforces that the
field is not present in the Create request data. While tolerated in the
current implementation, such use doesn’t follow best practice and may
cause error in the future.</p>

<h3 id="validation-for-update-requests">Validation for Update Requests</h3>

<p>@<code class="highlighter-rouge">ReadOnly</code> and @<code class="highlighter-rouge">CreateOnly</code> does not affect input data validation for
Rest.li update requests. This is because update is a PUT method and
should contain the whole entity, unlike partial update where
non-modified fields can be omitted. In the update request, the
@<code class="highlighter-rouge">ReadOnly</code> or @<code class="highlighter-rouge">CreateOnly</code> field is expected to have the same value as
the original entity (if the field was missing from the original entity,
it should be missing in the update request too). <em>However, this is not
checked by the Rest.li framework and should be checked manually in the
resource implementation.</em></p>

<h3 id="specifying-restli-validation-annotations">Specifying Rest.li Validation Annotations</h3>

<p>Rest.li validation annotations are specified on top of the resource. For
example,</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">`</span><span class="n">RestLiCollection</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"photos"</span><span class="o">,</span> <span class="n">namespace</span> <span class="o">=</span>
<span class="s">"com.linkedin.restli.example.photos"</span><span class="o">)</span>
<span class="err">`</span><span class="n">ReadOnly</span><span class="o">(</span><span class="err">“</span><span class="n">urn</span><span class="err">”</span><span class="o">)</span>  
<span class="err">`</span><span class="n">CreateOnly</span><span class="o">({</span><span class="s">"/id"</span><span class="o">,</span> <span class="s">"/EXIF"</span><span class="o">})</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">PhotoResource</span> <span class="kd">extends</span> <span class="n">CollectionResourceTemplate</span><span class="o">&lt;</span><span class="n">Long</span><span class="o">,</span>
<span class="n">Photo</span><span class="o">&gt;</span>
<span class="o">{</span>
<span class="o">...</span>
</code></pre></div></div>
<p>Every path should correspond to a field in a record, and not an enum
constant, a member of a union, etc. Paths should be specified in the
format used by
“PathSpec”:https://github.com/linkedin/rest.li/blob/master/data/src/main/java/com/linkedin/data/schema/PathSpec.java.
Note that the first / character can be either specified or omitted. You
can check the correct path for a field by getting its PathSpec and
calling toString(). For example, if the ValidationDemo record contains
an array field like this:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{
"name": "ArrayWithInlineRecord",
"type": {
"type": "array",
"items": {
"type": "record",
"name": "myItem",
"fields": [
{
"name": "bar1",
"type": "string"
},
{
"name": "bar2",
"type": "string"
}
]
}
},
"optional": true
}
</code></pre></div></div>
<p><code class="highlighter-rouge">ValidationDemo.fields().ArrayWithInlineRecord().items().bar1().toString()@
will return </code>/ArrayWithInlineRecord/*/bar1`.</p>

<p>You can also refer to these rules:<br />
For a non-nested field, put the field name. e.g. “stringA”<br />
For a nested field, put the full path separated by / characters. e.g.
“location/latitude”<br />
For a field of an array item, specify the array name followed by the
wildcard and the field name. e.g. “ArrayWithInlineRecord/*/bar1”<br />
Similarly, for a field of a map value, specify the map name followed by
the wildcard and the field name.<br />
For a field of a record inside a union, specify the union name, followed
by the fully qualified record schema name, and then the field name. e.g.
“UnionFieldWithInlineRecord/com.linkedin.restli.examples.greetings.api.myRecord/foo2”</p>

<p>Because full paths are listed, different rules can be specified for
records that have the same schema. For example, if the schema contains
two Photos, you can make the id of photo1 ReadOnly and id of photo2
non-ReadOnly. This is different from the optional/required distinction
specified in pdscs, where if the id of photo1 is required, the id of
photo2 will also be required.</p>

<h2 id="using-the-restli-data-validator-for-servers">Using the Rest.li Data Validator For Servers</h2>

<p>The Rest.li data validator can be called directly or indirectly using
the validation filters. When the resource calls it directly, it gets
specific error messages about where and why the validation failed, and
can decide how to handle the error. When a filter is used instead, the
resource does not get to examine why validation failed. Instead, the
client gets an error response with a message describing why the
validation failed. The validation filters are convenient if you want to
simply discard invalid requests or responses. On the other hand, if you
need to log the error or fail requests for only certain types of errors,
you need to call the validator directly.</p>

<h3 id="request-validation-before-resource-handling">Request validation before resource handling</h3>

<p>The
<a href="https://github.com/linkedin/rest.li/blob/master/restli-server/src/main/java/com/linkedin/restli/server/validation/RestLiValidationFilter.java">RestLiValidationFilter</a>
rejects all invalid requests automatically. It sends a 422
(Unprocessable Entity) error response back to the client if the data is
invalid. A sample error message is:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ERROR :: /stringA :: ReadOnly field present in a create request  
ERROR :: /stringB :: field is required but not found and has no default
value  
</code></pre></div></div>

<h3 id="response-validation-after-resource-handling">Response validation after resource handling</h3>

<p>The RestLiValidationFilter also discards all invalid responses. The
filter sends a 500 error response back to the client if the response is
invalid. A sample error message is:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ERROR :: /stringA :: length of “Lorem ipsum dolor sit amet” is out of
range 1…10  
ERROR :: /stringB :: field is required but not found and has no default
value  
</code></pre></div></div>

<p><a href="https://github.com/linkedin/rest.li/wiki/Rest.li-Filters#configuring-filters">Rest.li Filters -
Configuration</a>
explains how to install the filter.</p>

<h3 id="request-validation-during-resource-handling">Request validation during resource handling</h3>

<p>To use the Rest.li data validator explicitly, it needs to be declared as
a method parameter using the %````ValidatorParam```% annotation.
For example, to validate the input of a create request,</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">`</span><span class="n">RestMethod</span><span class="o">.</span><span class="na">Create</span>  
<span class="kd">public</span> <span class="n">CreateResponse</span> <span class="nf">create</span><span class="o">(</span><span class="kd">final</span> <span class="n">Fortune</span> <span class="n">entity</span><span class="o">,</span> <span class="nd">@ValidatorParam</span>
<span class="n">RestLiDataValidator</span> <span class="n">validator</span><span class="o">)</span>  
<span class="o">{</span>  
<span class="n">ValidationResult</span> <span class="n">result</span> <span class="o">=</span> <span class="n">validator</span><span class="o">.</span><span class="na">validateInput</span><span class="o">(</span><span class="n">entity</span><span class="o">);</span>  
<span class="k">if</span> <span class="o">(</span><span class="err">\</span><span class="o">!</span><span class="n">result</span><span class="o">.</span><span class="na">isValid</span><span class="o">())</span>  
<span class="o">{</span>  
<span class="k">throw</span> <span class="k">new</span>
<span class="nf">RestLiServiceException</span><span class="o">(</span><span class="n">HttpStatus</span><span class="o">.</span><span class="na">S_422_UNPROCESSABLE_ENTITY</span><span class="o">,</span>
<span class="n">result</span><span class="o">.</span><span class="na">getMessages</span><span class="o">().</span><span class="na">toString</span><span class="o">());</span>  
<span class="o">}</span>  
<span class="err">…</span>  
</code></pre></div></div>

<p>Batch requests have to be validated one by one:</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">`</span><span class="n">RestMethod</span><span class="o">.</span><span class="na">BatchPartialUpdate</span>
<span class="kd">public</span> <span class="n">BatchUpdateResult</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span> <span class="n">Fortune</span><span class="o">&gt;</span>
<span class="nf">batchUpdate</span><span class="o">(</span><span class="n">BatchPatchRequest</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span> <span class="n">Fortune</span><span class="o">&gt;</span> <span class="n">updates</span><span class="o">,</span> <span class="err">`</span><span class="n">ValidatorParam</span>
<span class="n">RestLiDataValidator</span> <span class="n">validator</span><span class="o">)</span>  
<span class="o">{</span>  
<span class="k">for</span> <span class="o">(</span><span class="n">Map</span><span class="o">.</span><span class="na">Entry</span><span class="err">\</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span> <span class="n">PatchRequest</span><span class="o">&lt;</span><span class="n">Fortune</span><span class="o">&gt;</span><span class="err">\</span><span class="o">&gt;</span> <span class="n">entry</span> <span class="o">:</span>
<span class="n">entityUpdates</span><span class="o">.</span><span class="na">getData</span><span class="o">().</span><span class="na">entrySet</span><span class="o">())</span>  
<span class="o">{</span>  
<span class="n">Integer</span> <span class="n">key</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="na">getKey</span><span class="o">();</span>  
<span class="n">PatchRequest</span><span class="o">&lt;</span><span class="n">Fortune</span><span class="o">&gt;</span> <span class="n">patch</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="na">getValue</span><span class="o">();</span>  
<span class="n">ValidationResult</span> <span class="n">result</span> <span class="o">=</span> <span class="n">validator</span><span class="o">.</span><span class="na">validateInput</span><span class="o">(</span><span class="n">patch</span><span class="o">);</span>  
<span class="k">if</span> <span class="o">(</span><span class="n">result</span><span class="o">.</span><span class="na">isValid</span><span class="o">())</span>  
<span class="o">{</span>  
<span class="c1">// update entity  </span>
<span class="o">}</span>  
<span class="k">else</span>  
<span class="o">{</span>  
<span class="n">errors</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">key</span><span class="o">,</span> <span class="k">new</span>
<span class="n">RestLiServiceException</span><span class="o">(</span><span class="n">HttpStatus</span><span class="o">.</span><span class="na">S_422_UNPROCESSABLE_ENTITY</span><span class="o">,</span>
<span class="n">result</span><span class="o">.</span><span class="na">getMessages</span><span class="o">().</span><span class="na">toString</span><span class="o">()));</span>  
<span class="o">}</span>  
<span class="o">}</span>  
<span class="err">…</span>  
</code></pre></div></div>

<p>The
<a href="https://github.com/linkedin/rest.li/blob/master/restli-int-test-server/src/main/java/com/linkedin/restli/examples/greetings/server/ValidationDemoResource.java">ValidationDemoResource</a>
class shows how to use the validator for each resource method type.</p>

<h3 id="response-validation-during-resource-handling">Response validation during resource handling</h3>

<p>Similar to request validation, the Rest.li data validator needs to be
declared as a method parameter.<br />
For example:</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">`</span><span class="n">RestMethod</span><span class="o">.</span><span class="na">BatchGet</span>
<span class="kd">public</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span> <span class="n">Fortune</span><span class="o">&gt;</span> <span class="nf">batchGet</span><span class="o">(</span><span class="n">Set</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">ids</span><span class="o">,</span> <span class="err">`</span><span class="n">ValidatorParam</span>
<span class="n">RestLiDataValidator</span> <span class="n">validator</span><span class="o">)</span>  
<span class="o">{</span>  
<span class="n">Map</span><span class="err">\</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span> <span class="n">Fortune</span><span class="err">\</span><span class="o">&gt;</span> <span class="n">resultMap</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="err">\</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span> <span class="n">Fortune</span><span class="err">\</span><span class="o">&gt;();</span>  
<span class="err">…</span>  
<span class="k">for</span> <span class="o">(</span><span class="n">Fortune</span> <span class="n">entity</span> <span class="o">:</span> <span class="n">resultMap</span><span class="o">.</span><span class="na">values</span><span class="o">())</span>  
<span class="o">{</span>  
<span class="n">ValidationResult</span> <span class="n">result</span> <span class="o">=</span> <span class="n">validator</span><span class="o">.</span><span class="na">validateOutput</span><span class="o">(</span><span class="n">entity</span><span class="o">);</span>  
<span class="k">if</span> <span class="o">(</span><span class="err">\</span><span class="o">!</span><span class="n">result</span><span class="o">.</span><span class="na">isValid</span><span class="o">())</span>  
<span class="o">{</span>  
<span class="c1">// fix the entity  </span>
<span class="o">}</span>  
<span class="o">}</span>  
<span class="err">…</span>  
</code></pre></div></div>

<h2 id="using-the-restli-data-validator-for-clients">Using the Rest.li Data Validator For Clients</h2>

<h3 id="request-validation">Request validation</h3>

<p>Clients can validate requests before sending it to the server, to ensure
that the request wouldn’t be rejected by the server. Request builders
for create, update, partial update and their respective batch operations
have validateInput() methods.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Photo</span> <span class="n">newPhoto</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Photo</span><span class="o">().</span><span class="na">setTitle</span><span class="o">(</span><span class="err">“</span><span class="n">New</span>
<span class="n">Photo</span><span class="err">”</span><span class="o">).</span><span class="na">setFormat</span><span class="o">(</span><span class="n">PhotoFormats</span><span class="o">.</span><span class="na">PNG</span><span class="o">)</span>  
<span class="o">.</span><span class="na">setExif</span><span class="o">(</span><span class="n">newExif</span><span class="o">);</span>  
<span class="n">ValidationResult</span> <span class="n">validationResult</span> <span class="o">=</span>
<span class="n">PhotosCreateRequestBuilder</span><span class="o">.</span><span class="na">validateInput</span><span class="o">(</span><span class="n">newPhoto</span><span class="o">);</span>  
<span class="k">if</span> <span class="o">(</span><span class="n">validationResult</span><span class="o">.</span><span class="na">isValid</span><span class="o">())</span>  
<span class="o">{</span>  
<span class="c1">// send request  </span>
<span class="o">}</span>  
<span class="k">else</span>  
<span class="o">{</span>  
<span class="c1">// fix photo  </span>
<span class="o">}</span>  
</code></pre></div></div>

<p>Input data for batch requests have to be validated one by one:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span> <span class="o">(</span><span class="n">PatchRequest</span><span class="o">&lt;</span><span class="n">Photo</span><span class="o">&gt;</span> <span class="n">patch</span> <span class="o">:</span> <span class="n">patches</span><span class="o">)</span>  
<span class="o">{</span>  
<span class="n">ValidationResult</span> <span class="n">validationResult</span> <span class="o">=</span>
<span class="n">PhotosPartialUpdateRequestBuilder</span><span class="o">.</span><span class="na">validateInput</span><span class="o">(</span><span class="n">patch</span><span class="o">);</span>  
<span class="k">if</span> <span class="o">(</span><span class="err">\</span><span class="o">!</span><span class="n">validationResult</span><span class="o">.</span><span class="na">isValid</span><span class="o">())</span>  
<span class="o">{</span>  
<span class="c1">// fix patch  </span>
<span class="o">}</span>  
<span class="err">…</span>  
</code></pre></div></div>

<h3 id="response-validation">Response validation</h3>

<p>When validating data returned by the server, clients have to use the
<code class="highlighter-rouge">ValidateDataAgainstSchema</code> class as explained below.</p>

<h2 id="validating-data-without-restli-context">Validating Data Without Rest.li Context</h2>

<p>When ReadOnly or CreateOnly annotations are used, Rest.li context
(method type, request vs response) is necessary to validate the data.
Otherwise the data and the schema information is enough. <a href="https://github.com/linkedin/rest.li/wiki/DATA-Data-Schema-and-Templates#data-to-schema-validation">Data to Schema
Validation</a>
explains how to validate data using the <code class="highlighter-rouge">ValidateDataAgainstSchema</code>
class. If it is used with <code class="highlighter-rouge">DataSchemaAnnotationValidator</code>, it will
consider the first two types of rules out of three listed in <a href="https://github.com/linkedin/rest.li/wiki/Validation-in-Rest.li#specifying-validation-rules">Specifying
Validation
Rules</a>.</p>

<p>For example:</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Send the request to the server and get the response  </span>
<span class="kd">final</span> <span class="n">Photo</span> <span class="n">photo</span> <span class="o">=</span>
<span class="n">restClient</span><span class="o">.</span><span class="na">sendRequest</span><span class="o">(</span><span class="n">request</span><span class="o">).</span><span class="na">getResponse</span><span class="o">().</span><span class="na">getEntity</span><span class="o">();</span>  
<span class="n">DataSchemaAnnotationValidator</span> <span class="n">validator</span> <span class="o">=</span> <span class="k">new</span>
<span class="n">DataSchemaAnnotationValidator</span><span class="o">(</span><span class="n">photo</span><span class="o">.</span><span class="na">schema</span><span class="o">());</span>  
<span class="n">ValidationResult</span> <span class="n">result</span> <span class="o">=</span>
<span class="n">ValidateDataAgainstSchema</span><span class="o">.</span><span class="na">validate</span><span class="o">(</span><span class="n">photo</span><span class="o">.</span><span class="na">data</span><span class="o">(),</span> <span class="n">photo</span><span class="o">.</span><span class="na">schema</span><span class="o">(),</span> <span class="k">new</span>
<span class="n">ValidationOptions</span><span class="o">(),</span> <span class="n">validator</span><span class="o">);</span>  
<span class="k">if</span> <span class="o">(</span><span class="err">\</span><span class="o">!</span><span class="n">result</span><span class="o">.</span><span class="na">isValid</span><span class="o">())</span>  
<span class="o">{</span>  
<span class="c1">// handle the error  </span>
<span class="o">}</span>  
</code></pre></div></div>

<h2 id="backwards-compatibility">Backwards Compatibility</h2>

<p>Adding or removing a ReadOnly or CreateOnly annotation for a field is
considered backwards incompatible. When an annotation is added, old
clients’ create or partial update requests may fail validation because
they still contain the field in the request. When an annotation is
removed, clients may have to send fields that they didn’t have to
before.</p>

                     </div>
                   </div>
</div>



      <footer class="page-footer">
    <div class="container">
      <div class="row">
        <div class="col s6">
          <h5>Rest.li</h5>
          <p class="text-lighten-4">Rest.li is an open source REST framework for building robust, scalable RESTful architectures using type-safe bindings and asynchronous, non-blocking IO. Rest.li fills a niche for applying RESTful principles at scale with an end-to-end developer workflow for building REST APIs, which promotes clean REST practices, uniform interface design and consistent data modeling.</p>
        </div>
        <div class="col s5 offset-s1">
          <h5 class="black-text">Community</h5>
          <ul>
              <li>Github <a class="" href="https://github.com/linkedin/rest.li">Rest.li</a></li>
              <li>Linkedin <a class="" href="http://www.linkedin.com/groups/Restli-4855943">Rest.li Group</a></li>
            <li>Follow us on twitter: <a class="" href="https://twitter.com/rest_li"> @rest_li</a></li>
            <li>Issue Tracking: <a class="" href="https://github.com/linkedin/rest.li/issues">github issue tracking</a></li>
          </ul>
        </div>
      </div>
    </div>
    <div class="footer-copyright">
        <div class="container">
            <div>
                <span style="text-align: right; float: left">
                Copyright © 2018. Powered by <a target="_blank" href="http://jekyllrb.com/" class="black-text text-lighten-3">Jekyll</a>
                </span> 
            </div>
        </div>  
    </div>
</footer>
      
    <!--  Scripts-->                                                                               
<script src="/js/jquery.min.js"></script>
<script src="/js/materialize.min.js"></script>
<script src="/js/init.js"></script>

  </body>

</html>
